
[1A[2K[WebServer] INFO:     Started server process [26896]
[1A[2K[WebServer] INFO:     Waiting for application startup.

[1A[2K[WebServer] Using data dir: D:\Proyectos_Cursor\CometLocal\data

[1A[2K[WebServer] [job_queue] Cargados 18 jobs desde disco

[1A[2K[WebServer] [job_queue] Worker iniciado

[1A[2K[WebServer] Config paths: org=D:\Proyectos_Cursor\CometLocal\data\refs\org.json people=D:\Proyectos_Cursor\CometLocal\data\refs\people.json platforms=D:\Proyectos_Cursor\CometLocal\data\refs\platforms.json secrets=D:\Proyectos_Cursor\CometLocal\data\refs\secrets.json documents=D:\Proyectos_Cursor\CometLocal\data\refs\documents.json

[1A[2K[WebServer] Using existing LLM config: D:\Proyectos_Cursor\CometLocal\backend\..\data\refs\llm_config.json

[1A[2K[WebServer] INFO:     Application startup complete.

[1A[2K[WebServer] INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)

[1A[2K[WebServer] INFO:     127.0.0.1:57548 - "GET /api/health HTTP/1.1" 200 OK


Running 1 test using 1 worker


[1A[2K(node:47088) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)



[1A[2K(node:47088) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
[1A[2K[1/1] tests\cae_pack_export_e2e.spec.js:43:5 √î√á‚ïë SPRINT C2.11.1: CAE Pack Export E2E √î√á‚ïë Genera y descarga pack CAE (ZIP)
[1A[2K[WebServer] INFO:     127.0.0.1:57550 - "GET /api/health HTTP/1.1" 200 OK

[1A[2Ktests\cae_pack_export_e2e.spec.js:43:5 √î√á‚ïë SPRINT C2.11.1: CAE Pack Export E2E √î√á‚ïë Genera y descarga pack CAE (ZIP)
[E2E] Server health OK - patch: v1.1.1

[1A[2K[WebServer] INFO:     127.0.0.1:57550 - "POST /api/test/seed/reset HTTP/1.1" 200 OK

[1A[2K[SEED] reset status: 200

[1A[2K[WebServer] INFO:     127.0.0.1:57550 - "POST /api/test/seed/basic_repository HTTP/1.1" 200 OK

[1A[2K[SEED] basic_repository status: 200 {
  company_key: [32m'E2E_COMPANY_86dc4bcb'[39m,
  person_key: [32m'E2E_PERSON_86dc4bcb'[39m,
  type_ids: [ [32m'E2E_TYPE_86dc4bcb_0'[39m ],
  doc_ids: [ [32m'E2E_DOC_86dc4bcb_0_0'[39m, [32m'E2E_DOC_86dc4bcb_0_1'[39m ],
  period_keys: [ [32m'2025-12'[39m, [32m'2025-11'[39m ],
  message: [32m'Created basic repository: 1 types, 2 docs, 2 missing periods'[39m
}

[1A[2K[WebServer] INFO:     127.0.0.1:52166 - "GET /repository HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [BOOT] __REPO_SCRIPT_LOADED__ = true

[1A[2K[CONSOLE LOG] [BOOT] repository_v3 script loaded

[1A[2K[CONSOLE LOG] [BOOT] typeof window.ensureCalendarioLoaded: function

[1A[2K[CONSOLE LOG] [BOOT] __REPO_API_READY__ set to true

[1A[2K[CONSOLE LOG] [BOOT] ensureCalendarioLoaded defined

[1A[2K[CONSOLE LOG] [BOOT] window.ensureCalendarioLoaded === undefined ? DEFINED

[1A[2K[CONSOLE LOG] [repo-upload] listener installed {time: 1768400683205}

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683234 bootstrap: start

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683235 bootstrap: app-ready set

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683235 initHashRouting: registering hashchange listener

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683235 bootstrap: calling runRoutingNow for initial hash

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683235 runRoutingNow: hash=, route=null

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683236 runRoutingNow: normalizing hash from  to #inicio

[1A[2K[WebServer] INFO:     127.0.0.1:60867 - "GET /api/health HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683236 bootstrap: completed

[1A[2K[CONSOLE LOG] [BOOT] __REPO_BOOTSTRAP_DONE__ set to true

[1A[2K[CONSOLE LOG] [EVENT] DOMContentLoaded

[1A[2K[CONSOLE LOG] [EVENT] window load

[1A[2K[WebServer] INFO:     127.0.0.1:60867 - "GET /api/repository/types HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [EVENT] hashchange -> #inicio

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683238 hashchange event fired

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683238 runRoutingNow: hash=#inicio, route=inicio

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683238 updateNavActive: updated nav for route=inicio

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683238 runRoutingNow: calling loadPage(inicio)

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683238 loadPage: start page=inicio

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683238 loadPage: content.innerHTML set to loading

[1A[2K[CONSOLE LOG] [SETVIEWSTATE] inicio loaded readyState= complete body exists= true

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683239 setViewState: inicio -> loaded on view-state-root

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683239 setViewState: inicio -> loaded applied, testId=view-inicio-loaded

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683240 bootstrap: E2E mode detected: true

[1A[2K[CONSOLE LOG] [EVENT] hashchange -> #calendario

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683267 hashchange event fired

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683267 runRoutingNow: hash=#calendario, route=calendario

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683267 updateNavActive: updated nav for route=calendario

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683267 runRoutingNow: calling loadPage(calendario)

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683267 loadPage: start page=calendario

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683267 loadPage: content.innerHTML set to loading

[1A[2K[CONSOLE LOG] [SETVIEWSTATE] calendario loaded readyState= complete body exists= true

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683267 setViewState: calendario -> loaded on view-state-root

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683267 setViewState: calendario -> loaded applied, testId=view-calendario-loaded

[1A[2K[CONSOLE LOG] [CAL] start

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683268 loadCalendario: start

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683268 ensureRepoDataLoaded: start

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683268 Loading types...

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683269 Loading people...

[1A[2K[CONSOLE LOG] [SETVIEWSTATE] calendario loaded readyState= complete body exists= true

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683280 setViewState: calendario -> loaded on view-state-root

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683280 setViewState: calendario -> loaded applied, testId=view-calendario-loaded

[1A[2K[CONSOLE LOG] [CAL] start

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683280 loadCalendario: start

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683280 ensureRepoDataLoaded: start

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683280 Loading types...

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683280 Loading people...

[1A[2K[WebServer] INFO:     127.0.0.1:53597 - "GET /api/repository/docs?limit=50&sort=date_desc HTTP/1.1" 200 OK

[1A[2K[WebServer] INFO:     127.0.0.1:52514 - "GET /api/repository/rules HTTP/1.1" 200 OK

[1A[2K[WebServer] INFO:     127.0.0.1:60406 - "GET /api/config/platforms HTTP/1.1" 200 OK

[1A[2K[WebServer] INFO:     127.0.0.1:60867 - "GET /api/repository/types HTTP/1.1" 200 OK

[1A[2K[WebServer] INFO:     127.0.0.1:63913 - "GET /favicon.ico HTTP/1.1" 404 Not Found

[1A[2K[WebServer] INFO:     127.0.0.1:52984 - "GET /api/config/people HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [SETVIEWSTATE] inicio ready readyState= complete body exists= true

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683386 setViewState: inicio -> ready on view-state-root

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683386 setViewState: inicio -> ready applied, testId=view-inicio-ready

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683386 runRoutingNow: loadPage(inicio) completed

[1A[2K[CONSOLE ERROR] Failed to load resource: the server responded with a status of 404 (Not Found)

[1A[2K[WebServer] INFO:     127.0.0.1:52514 - "GET /api/repository/types HTTP/1.1" 200 OK

[1A[2K[WebServer] INFO:     127.0.0.1:60406 - "GET /favicon.ico HTTP/1.1" 404 Not Found

[1A[2K[WebServer] INFO:     127.0.0.1:63913 - "GET /api/config/people HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683395 Types loaded:

[1A[2K[CONSOLE ERROR] Failed to load resource: the server responded with a status of 404 (Not Found)

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683396 People loaded:

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683396 ensureRepoDataLoaded: done

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683396 loadCalendario: max_months_back=12 (E2E=true, original=24)

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683396 loadCalendario: before fetch pendings

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683397 Types loaded:

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683397 People loaded:

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683397 ensureRepoDataLoaded: done

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683397 loadCalendario: max_months_back=12 (E2E=true, original=24)

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683397 loadCalendario: before fetch pendings

[1A[2K[WebServer] [PENDING] ms_total=21, ms_read=8, ms_calc=0, ms_missing=8, counts=docs=22, expired=22, expiring=0, missing=10

[1A[2K[WebServer] INFO:     127.0.0.1:63913 - "GET /api/repository/docs/pending?months_ahead=3&max_months_back=12 HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683422 loadCalendario: after fetch pendings

[1A[2K[CONSOLE LOG] [CAL] after fetch pending {expired: 22, expiringSoon: 0, missing: 10}

[1A[2K[WebServer] [PENDING] ms_total=26, ms_read=10, ms_calc=1, ms_missing=10, counts=docs=22, expired=22, expiring=0, missing=10

[1A[2K[WebServer] INFO:     127.0.0.1:60406 - "GET /api/repository/docs/pending?months_ahead=3&max_months_back=12 HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683451 loadCalendario: after fetch pendings

[1A[2K[CONSOLE LOG] [CAL] after fetch pending {expired: 22, expiringSoon: 0, missing: 10}

[1A[2K[WebServer] INFO:     127.0.0.1:63913 - "GET /api/repository/subjects HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683461 loadCalendario: after render table

[1A[2K[WebServer] INFO:     127.0.0.1:60406 - "GET /api/repository/subjects HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [CAL] after render

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683462 loadCalendario: end

[1A[2K[CONSOLE LOG] [CAL] end

[1A[2K[CONSOLE LOG] [SETVIEWSTATE] calendario ready readyState= complete body exists= true

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683462 setViewState: calendario -> ready on view-state-root

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683462 setViewState: calendario -> ready applied, testId=view-calendario-ready

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683462 runRoutingNow: loadPage(calendario) completed

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683480 loadCalendario: after render table

[1A[2K[CONSOLE LOG] [CAL] after render

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683480 loadCalendario: end

[1A[2K[CONSOLE LOG] [CAL] end

[1A[2K[CONSOLE LOG] [SETVIEWSTATE] calendario ready readyState= complete body exists= true

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683480 setViewState: calendario -> ready on view-state-root

[1A[2K[CONSOLE LOG] [VIEWDBG] 1768400683480 setViewState: calendario -> ready applied, testId=view-calendario-ready

[1A[2K[WebServer] INFO:     127.0.0.1:60406 - "GET /api/config/platforms HTTP/1.1" 200 OK

[1A[2K[CONSOLE LOG] [repo-upload] change captured {targetTag: SELECT, hasClass: false, fileIdAttr: null, time: 1768400684157}

[1A[2K[CONSOLE LOG] [repo-upload] change captured {targetTag: SELECT, hasClass: false, fileIdAttr: null, time: 1768400684382}

[1A[2K[CONSOLE LOG] [repo-upload] change captured {targetTag: SELECT, hasClass: false, fileIdAttr: null, time: 1768400684597}

[1A[2K[WebServer] INFO:     127.0.0.1:60406 - "POST /api/cae/plan HTTP/1.1" 200 OK

[1A[2K[E2E] Plan no tiene documentos seleccionados. Usando doc_ids del seed directamente.

[1A[2K[E2E] Seed doc_ids: [ [32m'E2E_DOC_86dc4bcb_0_0'[39m, [32m'E2E_DOC_86dc4bcb_0_1'[39m ]

[1A[2K[CONSOLE LOG] [repo-upload] change captured {targetTag: SELECT, hasClass: false, fileIdAttr: null, time: 1768400684974}

[1A[2K  1) tests\cae_pack_export_e2e.spec.js:43:5 √î√á‚ïë SPRINT C2.11.1: CAE Pack Export E2E √î√á‚ïë Genera y descarga pack CAE (ZIP) 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeEnabled[2m([22m[2m)[22m failed

    Locator:  locator('[data-testid="cae-pack-generate-button"]')
    Expected: enabled
    Received: disabled
    Timeout:  5000ms

    Call log:
    [2m  - Expect "toBeEnabled" with timeout 5000ms[22m
    [2m  - waiting for locator('[data-testid="cae-pack-generate-button"]')[22m
    [2m    9 ‚îú√π locator resolved to <button disabled class="btn btn-primary" onclick="generateCAEPack()" data-testid="cae-pack-generate-button">√î√•√Å                            Generar pack (ZIP)√î√•√Å √î√á¬™</button>[22m
    [2m      - unexpected value "disabled"[22m


      182 |         const packGenerateButton = page.locator('[data-testid="cae-pack-generate-button"]');
      183 |         await expect(packGenerateButton).toBeVisible();
    > 184 |         await expect(packGenerateButton).toBeEnabled();
          |                                          ^
      185 |         await packGenerateButton.click();
      186 |         
      187 |         // Esperar descarga
        at D:\Proyectos_Cursor\CometLocal\tests\cae_pack_export_e2e.spec.js:184:42

    Error: page.waitForEvent: Test ended.
    =========================== logs ===========================
    waiting for event "download"
    ============================================================

      177 |         
      178 |         // Configurar descarga
    > 179 |         const downloadPromise = page.waitForEvent('download', { timeout: 60000 });
          |                                      ^
      180 |         
      181 |         // Click en bot‚îú‚îÇn "Generar pack (ZIP)"
      182 |         const packGenerateButton = page.locator('[data-testid="cae-pack-generate-button"]');
        at D:\Proyectos_Cursor\CometLocal\tests\cae_pack_export_e2e.spec.js:179:38

    attachment #1: screenshot (image/png) √î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á
    test-results\cae_pack_export_e2e-SPRINT-44a47-ra-y-descarga-pack-CAE-ZIP-\test-failed-1.png
    √î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á√î√∂√á

    Error Context: test-results\cae_pack_export_e2e-SPRINT-44a47-ra-y-descarga-pack-CAE-ZIP-\error-context.md


[1A[2K  1 failed
    tests\cae_pack_export_e2e.spec.js:43:5 √î√á‚ïë SPRINT C2.11.1: CAE Pack Export E2E √î√á‚ïë Genera y descarga pack CAE (ZIP) 
